<html xmlns:th="http://www.thymeleaf.org">
<head th:include="layout :: head(title=~{::title},links=~{})">
<title>Labor and Delivery Reports</title>
</head>
<body th:include="layout :: body" th:with="content=~{::content}">
	<div th:fragment="content">















		<script th:inline="javascript">
			"use strict";

			/* Otherwise Thymeleaf tries to parse Javascript as XML and breaks itself sometimes.  Sigh */
			/*<![CDATA[*/
			var app = angular.module('myApp', []);
			app
					.controller(
							'laborDeliveryReports',
							function($scope, $http) {

								// Display users' names
								$scope.displayName = function(p) {
									return p.firstName + " " + p.lastName
											+ " (" + p.self.username + ")";
								}

								$scope.deliveryMethods = [ 'Vaginal Delivery',
										'Caesarean Section', 'Miscarriage' ];
								$scope.twinOptions = [ 'Yes', 'No' ];

								// documentation on Angular filters: https://docs.angularjs.org/api/ng/filter/filter
								$scope.searchFilter = "";
								$scope.filterPatients = function(patient) {
									return ($scope.displayName(patient))
											.toLowerCase().match(
													$scope.searchFilter
															.toLowerCase());
								}

								$scope.form = {
									deliveryMethods : '',
									twinOptions : '',
						
									
								};
								
								$scope.entry = {
									twinOption : ''
								}

								//Get info for the patients
								$http.get("/iTrust2/api/v1/patients/female")
										.then(function(response) {
											$scope.patients = response.data; //get only female patients
										}, function(rejection) {
											$scope.patient = null;
										});

								$scope.selectPatient = function(patient) {

									$scope.displayCreateLD = false;
									$scope.boolMiscarriage = false;
									$scope.showTwinForm = false;

									//$scope.patientRecords = 
									//HOW TO GET RECORDS FOR THIS PATIENT?
									//POSSIBLE METHOD IN LaborDeliveryReport.java

									// Get past pregnancy info for patient
									$http.get(
											"/iTrust2/api/v1/LaborDelivery/"
													+ $scope.patients
													+ $scope.selectedPatient)
											.then(function(response) { // on success

											}, //if it failed
											function(rejection) {

											});
									// Get current pregnancy info for patient
									$http
											.get(
													"/iTrust2/api/v1/obstetricsrecord/"
															+ $scope.selectedPatient)
											.then(
													function(response) { // on success
														$scope.currentPregnancy = response.data
																|| {};
														$scope.lmpInputDate = new Date();
														$scope.lmp = response.data.lastMenstrualPeriod;
														$scope.estDueDate = response.data.estDueDate;
														$scope.numWeeksPregnant = response.data.numWeeksPregnant;
														$scope.message = "";
													}, //if it failed
													function(rejection) {
														$scope.currentPregnancy = {};
														$scope.message = "Could not display current pregnancy.";
													});

									// Get current pregnancy info for patient                        	

								};

								$scope.displayCreateLD = false;

								$scope.displayCreateForm = function() {
									$scope.displayCreateLD = true;
								}

								$scope.submitLD = function() {

									// Date info: https://docs.oracle.com/javase/7/docs/api/java/util/Date.html#getMonth()

									//Clear any error messages
									$scope.errorMsg = "";

									// Post the record to the REST API endpoint, and handle success/error
									$http
											.post(
													"/iTrust2/api/v1/LaborDelivery",
													$scope.form)
											.then(
													function success(response) {
														if (response.data.patient) { //patient only exists on success
															$scope.message = "Obstetrics record has been added successfully."
															$scope.form = {
																deliveryMethod : ''
															};
															$scope.errorMsg = "";
															document.location.href = '/iTrust2/hcp/laborDeliveryReports.html';
														}
													},
													function failure(rejection) {
														$scope
																.failAddObsEntry();
													});
								}

								//$scope.deliveryString = document.getElementById("deliveryMethod");
								$scope.isMiscarriage = function() {
									console.log("Test");
									if($scope.form.deliveryMethod != 'Miscarriage') {
									  $scope.showForm = true;
									} else {
										$scope.showForm = false;
									}
								}
								
								$scope.checkTwin = function() {
									console.log("Test TWINS");
									if($scope.entry.twinOption == 'Yes') {
										  $scope.showTwinForm = true;
										} else {
											$scope.showTwinForm = false;
										}
								}

							});
			/*]]>*/
		</script>






















		<div ng-app="myApp" ng-controller="laborDeliveryReports" class="row">
			<div class="col-md-3">
				<h2>Patients:</h2>
				<!-- info on filtering taken from here: https://www.w3schools.com/angular/angular_filters.asp
                    and https://docs.angularjs.org/api/ng/filter/filter -->
				<h4>
					Search: <input type="text" name="search" ng-model="searchFilter" />
				</h4>
				<!-- Info on scrolling taken from here: https://www.w3schools.com/cssref/pr_pos_overflow.asp -->
				<!-- and here: https://stackoverflow.com/questions/9560330/how-to-hide-a-vertical-scroll-bar-when-not-needed -->
				<div>
					<div class="radio"
						ng-repeat="patient in patients | filter:filterPatients">
						<label> <input type="radio" id="{{patient.self.username}}"
							ng-model="$parent.selectedPatient" name="patient"
							value="{{patient.self.username}}"
							ng-click='$parent.selectPatient(patient)' />
							&nbsp;{{$parent.displayName(patient)}}
						</label>
					</div>
				</div>
			</div>
			<!-- information on vertical rule found here: https://stackoverflow.com/questions/571900/is-there-a-vr-vertical-rule-in-html  -->
			<div
				style="float: left; width: 70%; border-left: 1px solid #bbb; padding-left: 3%; height: 75%; overflow-y: auto">
				<h2 id="header0">View Patient Information</h2>


				<div ng-if="selectedPatient && currentPregnancy.length > 0">
					<b>Current Pregnancy Information: </b> <br> Last Menstrual
					Period: {{currentPregnancy[0].lastMenstrualPeriod}} <br>
					Estimated Due Date: {{currentPregnancy[0].estDueDate}} <br>
					Weeks Pregnant: {{currentPregnancy[0].numWeeksPregnant}}
				</div>


				<div class="form-group" ng-if="selectedPatient">
					<button type="submit" class="btn btn-primary"
						ng-click=displayCreateForm() name="displayCreateForm"
						id=displayCreateForm>Create Labor and Delivery Report</button>
				</div>


				<div ng-if="!previousReports && previousReports.length == 0">
					<br> <b>CHANGE THIS: Previous Labor and Delivery Reports</b>
				</div>

				<table class="table table-bordered">
					<!-- ng-repeat="pregnancy in priorPregnancies">  -->
					<thead>
						<tr>
							<th>Labor Date</th>
							<th>Labor Time</th>
							<th>Delivery Date</th>
							<th>Delivery Time</th>
							<th>Type of Delivery</th>
						</tr>
					</thead>

					<tbody>
						<!--	<tr ng-repeat="patient in patients">
							<td id="laborDate-{{$index}}">{{pregnancy.conceptionYear}}</td>
							<td id="laborTime-{{$index}}">{{pregnancy.numberOfWeeksPregnant}}</td>
							<td id="deliveryDate-{{$index}}">{{pregnancy.numberOfHoursInLabor}}</td>
							<td id="deliveryTime-{{$index}}">{{pregnancy.deliveryMethod}}</td>
							<td id="type-{{$index}}" ng-if="pregnancy.twins">Yes</td>
						</tr> -->
					</tbody>
				</table>


				<table class="table table-bordered">
					<!-- ng-repeat="pregnancy in priorPregnancies">  -->
					<thead>
						<tr>
							<th>Labor Date</th>
							<th>Labor Time</th>
							<th>Delivery Date</th>
							<th>Delivery Time</th>
							<th>Type of Delivery</th>
							<th>First Name</th>
							<th>Last Name</th>
							<th>Weight</th>
							<th>Height/Length</th>
							<th>Heart Rate</th>
							<th>Systolic Blood Pressure</th>
							<th>Diastolic Blood Pressure</th>
						</tr>
					</thead>

					<tbody>
						<tr ng-repeat="pregnancy in priorPregnancies">
							<td id="conceptionYear-{{$index}}">{{pregnancy.conceptionYear}}</td>
							<td id="numWeeksPregnant-{{$index}}">{{pregnancy.numberOfWeeksPregnant}}</td>
							<td id="numHoursInLabor-{{$index}}">{{pregnancy.numberOfHoursInLabor}}</td>
							<td id="deliveryMethod-{{$index}}">{{pregnancy.deliveryMethod}}</td>
							<td id="twins-{{$index}}" ng-if="pregnancy.twins">Yes</td>
							<td id="twins2-{{$index}}" ng-if="!pregnancy.twins">No</td>
						</tr>
					</tbody>

					<thead>
						<tr ng-if="twins">
							<th>Labor Date</th>
							<th>Labor Time</th>
							<th>Delivery Date</th>
							<th>Delivery Time</th>
							<th>Delivery Method</th>
							<th>First Name</th>
							<th>Last Name</th>
							<th>Weight</th>
							<th>Height/Length</th>
							<th>Heart Rate</th>
							<th>Systolic Blood Pressure</th>
							<th>Diastolic Blood Pressure</th>
						</tr>
					</thead>

					<tbody>
						<!-- <tr ng-repeat="pregnancy in priorPregnancies track by $index"> -->
						<tr ng-repeat="pregnancy in priorPregnancies">
							<td id="conceptionYear-{{$index}}">{{pregnancy.conceptionYear}}</td>
							<td id="numWeeksPregnant-{{$index}}">{{pregnancy.numberOfWeeksPregnant}}</td>
							<td id="numHoursInLabor-{{$index}}">{{pregnancy.numberOfHoursInLabor}}</td>
							<td id="deliveryMethod-{{$index}}">{{pregnancy.deliveryMethod}}</td>
							<td id="twins-{{$index}}" ng-if="pregnancy.twins">Yes</td>
							<td id="twins2-{{$index}}" ng-if="!pregnancy.twins">No</td>
						</tr>
					</tbody>
				</table>





				<div ng-if="displayCreateLD">

					<div class="row">
						<div class="col">
							<div style="margin-left: 10px;">
								<b>New Labor and Delivery Report</b>
							</div>

							<div class="col-md-5">
								<div class="form-group">
									<label for="conceptionYear">Date of Labor</label>
									<div class="input-group">
										<input class="form-control" id="conceptionYear" type="number"
											ng-model="pregnancyEntry.conceptionYear"
											name="conceptionYear" />
									</div>
								</div>

								<div class="form-group">
									<label for="conceptionYear">Time of Labor</label>
									<div class="input-group">
										<input class="form-control" id="conceptionYear" type="number"
											ng-model="pregnancyEntry.conceptionYear"
											name="conceptionYear" />
									</div>
								</div>

								<div class="form-group">
									<label for="conceptionYear">Date of Delivery</label>
									<div class="input-group">
										<input class="form-control" id="conceptionYear" type="number"
											ng-model="form.conceptionYear" name="conceptionYear" />
									</div>
								</div>

								<div class="form-group">
									<label for="conceptionYear">Time of Delivery</label>
									<div class="input-group">
										<input class="form-control" id="conceptionYear" type="number"
											ng-model="pregnancyEntry.conceptionYear"
											name="conceptionYear" />
									</div>
								</div>


								<div class="form-group col-md-4">
										<label>Delivery Method:</label>

										<div class="panel panel-default">
											<div class="panel-body">
												<div class="form-check">
													<ul
														style="overflow: auto; list-style: none;">
														<li ng-repeat="deliveryMethod in deliveryMethods"><label> <input
																type="radio" ng-model="form.deliveryMethod"
																name="{{deliveryMethod}}" value="{{deliveryMethod}}" required="true" ng-click = "isMiscarriage()" /> {{deliveryMethod}}
														</label></li>
													</ul>
												</div>
											</div>
										</div>
									</div>
									
									<div class="form-group col-md-4">
										<label>Twins?:</label>

										<div class="panel panel-default">
											<div class="panel-body">
												<div class="form-check">
													<ul
														style="overflow: auto; list-style: none;">
														<li ng-repeat="twinOption in twinOptions"><label> <input
																type="radio" ng-model="entry.twinOption"
																name="{{twinOption}}" value="{{twinOption}}" required="true" ng-click = "checkTwin()" /> {{twinOption}}
														</label></li>
													</ul>
												</div>
											</div>
										</div>
									</div>



								
								<!-- IF NOT A MISCARRIAGE SHOW REST OF FIELDS -->
								<div ng-if="showForm">
									<div class="form-group">
										<label for="numHoursInLabor">Weight</label> <input
											class="form-control" id="numHoursInLabor" type="number"
											ng-model="pregnancyEntry.numHoursInLabor"
											name="numHoursInLabor" />
									</div>

									<div class="form-group">
										<label for="deliveryMethod">Length</label> <select
											class="form-control" ng-model="pregnancyEntry.deliveryMethod"
											id="deliveryMethod" name="deliveryMethod">
											<option ng-repeat="deliveryMethod in deliveryMethods">{{deliveryMethod}}</option>
										</select>
									</div>

									<div class="form-group">
										<label for="deliveryMethod">Heart Rate</label> <select
											class="form-control" ng-model="pregnancyEntry.deliveryMethod"
											id="deliveryMethod" name="deliveryMethod">
											<option ng-repeat="deliveryMethod in deliveryMethods">{{deliveryMethod}}</option>
										</select>
									</div>

									<div class="form-group">
										<label for="deliveryMethod">Systolic Blood Pressure</label> <select
											class="form-control" ng-model="pregnancyEntry.deliveryMethod"
											id="deliveryMethod" name="deliveryMethod">
											<option ng-repeat="deliveryMethod in deliveryMethods">{{deliveryMethod}}</option>
										</select>
									</div>

									<div class="form-group">
										<label for="deliveryMethod">Diastolic Blood Pressure</label> <select
											class="form-control" ng-model="pregnancyEntry.deliveryMethod"
											id="deliveryMethod" name="deliveryMethod">
											<option ng-repeat="deliveryMethod in deliveryMethods">{{deliveryMethod}}</option>
										</select>
									</div>

									<div class="form-group">
										<label for="deliveryMethod">First Name</label> <select
											class="form-control" ng-model="pregnancyEntry.deliveryMethod"
											id="deliveryMethod" name="deliveryMethod">
											<option ng-repeat="deliveryMethod in deliveryMethods">{{deliveryMethod}}</option>
										</select>
									</div>

									<div class="form-group">
										<label for="deliveryMethod">Last Name</label> <select
											class="form-control" ng-model="pregnancyEntry.deliveryMethod"
											id="deliveryMethod" name="deliveryMethod">
											<option ng-repeat="deliveryMethod in deliveryMethods">{{deliveryMethod}}</option>
										</select>
									</div>





									<!-- IF TWINS, NEW TABLE -->

									<div ng-if="showForm && showTwinForm">

										<div class="row">
											<div class="col">
												<div style="margin-left: 10px;">
													<b>New Labor and Delivery Report</b>
												</div>


												<div class="form-group">
													<label for="conceptionYear">Time of Labor</label>
													<div class="input-group">
														<input class="form-control" id="conceptionYear"
															type="number" ng-model="pregnancyEntry.conceptionYear"
															name="conceptionYear" />
													</div>
												</div>


												<div class="form-group">
													<label for="conceptionYear">Time of Delivery</label>
													<div class="input-group">
														<input class="form-control" id="conceptionYear"
															type="number" ng-model="pregnancyEntry.conceptionYear"
															name="conceptionYear" />
													</div>
												</div>


												<div class="form-group">
													<label for="numHoursInLabor">Weight</label> <input
														class="form-control" id="numHoursInLabor" type="number"
														ng-model="pregnancyEntry.numHoursInLabor"
														name="numHoursInLabor" />
												</div>

												<div class="form-group">
													<label for="deliveryMethod">Length</label> <select
														class="form-control"
														ng-model="pregnancyEntry.deliveryMethod"
														id="deliveryMethod" name="deliveryMethod">
														<option ng-repeat="deliveryMethod in deliveryMethods">{{deliveryMethod}}</option>
													</select>
												</div>

												<div class="form-group">
													<label for="deliveryMethod">Heart Rate</label> <select
														class="form-control"
														ng-model="pregnancyEntry.deliveryMethod"
														id="deliveryMethod" name="deliveryMethod">
														<option ng-repeat="deliveryMethod in deliveryMethods">{{deliveryMethod}}</option>
													</select>
												</div>

												<div class="form-group">
													<label for="deliveryMethod">Systolic Blood Pressure</label>
													<select class="form-control"
														ng-model="pregnancyEntry.deliveryMethod"
														id="deliveryMethod" name="deliveryMethod">
														<option ng-repeat="deliveryMethod in deliveryMethods">{{deliveryMethod}}</option>
													</select>
												</div>

												<div class="form-group">
													<label for="deliveryMethod">Diastolic Blood
														Pressure</label> <select class="form-control"
														ng-model="pregnancyEntry.deliveryMethod"
														id="deliveryMethod" name="deliveryMethod">
														<option ng-repeat="deliveryMethod in deliveryMethods">{{deliveryMethod}}</option>
													</select>
												</div>

												<div class="form-group">
													<label for="deliveryMethod">First Name</label> <select
														class="form-control"
														ng-model="pregnancyEntry.deliveryMethod"
														id="deliveryMethod" name="deliveryMethod">
														<option ng-repeat="deliveryMethod in deliveryMethods">{{deliveryMethod}}</option>
													</select>
												</div>

												<div class="form-group">
													<label for="deliveryMethod">Last Name</label> <select
														class="form-control"
														ng-model="pregnancyEntry.deliveryMethod"
														id="deliveryMethod" name="deliveryMethod">
														<option ng-repeat="deliveryMethod in deliveryMethods">{{deliveryMethod}}</option>
													</select>
												</div>



											</div>
										</div>
									</div>
									<!--closes ngif twin -->



								</div>
								<!--closes ngif notMiscarriage -->

							</div>

							<div class="form-group"
								ng-if="selectedPatient && displayCreateLD">
								<button type="submit" class="btn btn-primary"
									ng-click=submitLD() name="submitLD" id="submitLD">Submit
									Labor and Delivery Report</button>
							</div>

							<div class="form-group">
								<div name="success" class="text-success"
									style="white-space: pre;">{{message}}</div>
								<div name="errorMsg" class="text-danger"
									style="white-space: pre;">{{errorMsg}}</div>
							</div>
						</div>
					</div>
				</div>
				<!-- CLOSES LABOR AND DELIVERY REPORT CREATE FORM -->


			</div>
		</div>
	</div>
	</div>
</body>
</html>